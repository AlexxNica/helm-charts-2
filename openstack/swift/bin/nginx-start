#!/bin/sh

cp -f /etc/nginx/nginx.conf  /etc/nginx/nginx.conf.orig
cp -f /swift-etc-cluster/nginx.conf  /etc/nginx
cp -f /swift-etc/dhparam.pem /etc/nginx

mkdir -p /etc/nginx/ssl
cp -f /tls-secret/tls.crt /etc/nginx/ssl
cp -f /tls-secret/tls.key /etc/nginx/ssl

cp -f /swift-bin/nginx-cert-watch /usr/local/bin/nginx-cert-watch
chmod +x /usr/local/bin/nginx-cert-watch

[ "$DEBUG_CONTAINER" = true ] && exec tail -f /dev/null

# Get notified when certs are changed via vive-president
inotifyd /usr/local/bin/nginx-cert-watch /tls-secret/tls.crt:c &

nginx -g 'daemon off;'
